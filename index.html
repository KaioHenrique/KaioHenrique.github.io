<!DOCTYPE html>
<html>
	<head>
		<title>Kaio Henrique de Melo Chiarato</title>
		<style type="text/css">
			@-webkit-keyframes pointer-animation {
				from { opacity: 0; }
				to { opacity: 1; }
			} 

			@keyframes pointer-animation {
				from { opacity: 0; }
				to { opacity: 1; }
			}

			html,
			body {
				width: 100%;
				height: 100%;
				background-color: #000000;
				font-size: 16px;
				margin: 0px !important;
				color: green;
			}

			* {
				outline: none !important;
			}

			#cmd {
				padding: 15px;
				font-family: 'Consolas';
				font-size: 0;
			}

			#cmd > * {
				font-size: 1rem;
			}

			#pointer {
				padding: 0px;
				
			}

			#pointer.animation {
				-webkit-animation: pointer-animation 1s infinite;
				animation: pointer-animation 1s infinite;
			}
		</style>
		<script type="text/javascript">



			function getToken(content, index) {
				var token = "";
				do {
					token += content[index];
					index++;
				} while (content[index] != "(" && content[index] != "\\" && content[index] != "{");
				return { strToken : token, indexEnd : index - 1};
			}

			function getParameter(content, index) {
				var token = "";
				index++;
				if (content[index] == "("){
					do {
						token += content[index];
						index++;
					} while (content[index] != ")");
					return { strToken : token.substring(1), indexEnd : index};	
				}

				console.error("Erro de sintaxe");				
			}

			function getContent(content, index) {
				var token = "";
				index++;
				if (content[index] == "{"){
					do {
						token += content[index];
						index++;
					} while (content[index] != "}");
					return { strToken : token.substring(1), indexEnd : index};	
				}

				console.error("Erro de sintaxe");					
			}

			

			function newProp() {
				return {color : stackProperties[0].color};
			}

			function parser(content, index){
				var p = new newProp();							
				var token = getToken(content, index);
				if (token.strToken = "\\color") {
					var parameter = getParameter(content, token.indexEnd);					
					p.color = parameter.strToken;
				}

				var conteudo = getContent(content, parameter.indexEnd);

				return {Content : conteudo,  Position : conteudo.indexEnd + 1, Prop : p};
			}

			function addStack(prop, indexEndStack) {
				stackProperties.unshift(prop);
				stack.unshift(indexEndStack);
			}

			function write(el, str, timeout, speed, callInit, callback) {
				var position = 0;
				setTimeout(function() {
					if(typeof(callInit) == 'function')
						callInit();

					var idInterval = setInterval(function() {

						if (str[position] == "@"){
							var parsed = parser(str, position + 1);													
							var comando = str.substr(position, parsed.Position - position);
							str = str.replace(comando, parsed.Content.strToken);	
							addStack(parsed.Prop, parsed.Content.strToken.length +  position);
						}

						var char = str[position] == '\n' ? '<br>' : str[position];
						el.innerHTML += `<span>${char}</span>`;

						if (stack.length > 0) {
							if (stack[0] == position){
								stackProperties.shift();
								stack.shift();
							}
						}

						position++;
						if(position == str.length) {
							clearInterval(idInterval);
							if(typeof(callback) == 'function')
								callback();
						}
					}, speed || 75);
				}, timeout);
			}

			function erase(el, size, timeout, speed, callback) {
				var amountErase = 0;
				setTimeout(function() {
					var idInterval = setInterval(function() {
						el.children[(el.children.length - 1)].remove();
						amountErase++;
						if(amountErase == size) {
							clearInterval(idInterval);
							if(callback && typeof(callback) == 'function')
								callback();
						}
					}, speed || 75);
				}, timeout);
			}

			function writeListText(el, objStr, callInit, callback, position) {
				position = position ? position : 0;

				write(el, objStr[position].text, objStr[position].timeout, objStr[position].speed, callInit, function() {
					var objErase = objStr[position].erase || null;

					callback();
					if(objErase) {
						erase(el, objErase.size, objErase.timeout, objErase.speed, function() {
							position++;
							if(objStr[position])
								writeListText(el, objStr, callInit, callback, position);
						});
					}
					else {
						position++;
						if(objStr[position])
							writeListText(el, objStr, callInit, callback, position);
					}
				});
			}

			var stack = [];
			var stackProperties = [];

			window.onload = function() {
				stackProperties.unshift({color : "green"});
				var el = document.getElementById('txt'),
					objStr = [
						{text: 'Olá! @\\color(#000000){Kaio Henrique de Melo Chiarato} Blah blah blah', timeout: 500},
						{text: 'Eu sou o Kaio', timeout: 1000},
						{text: ' e este é o meu currículo!', timeout: 1000}
					];
				
				writeListText(el, objStr,
					function() { document.getElementById('pointer').classList.remove('animation'); },
					function() { document.getElementById('pointer').classList.add('animation'); }
				);
			}
		</script>
	</head>
	<body>
		<main>
			<article id="cmd">
				<span>k></span>
				<span id="txt"></span>
				<span id="pointer" class="animation">▍</span>
			</article>	
		</main>
	</body>
</html>